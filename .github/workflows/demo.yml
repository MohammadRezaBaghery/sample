name: build

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v4

      # Runs a single command using the runners shell
      - name: setup node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: install dependencies
        run: npm install
      - name: build
        run: npm run build
  
  deploy:

    needs: [ build ]
    runs-on: ubuntu-latest

    steps: 
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup SSH key
        run: |
          mkdir -p ~/.ssh
          echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDRmGQKfnfZ0n7eC0URmuUgTPg79/9s5J1nutLpsU+iQUa7mB98Tx8oNWivIKDFUCZtBT4/dNZfpSh1lLkR0Z9FufP9L79aVwLX9+GuoQRPleUSuEObcPPBBiSTO9smD8sK5yEy3kiyIfc9eeK8MtTPhNl8X1sMvjPAkiN1okQcNYRNppK5KL4ylsbty/VLRq/jaKxyUVySWo9HjxUiQNU2MC+hI0DqfPG3yfV76llQPnbtCLD98GZBUDqL/iX8SYI0JBB0/gjlWh+5sc9qp/iXvj3F2futyLOSc1m7ZDiP54i0VgdzcnJUYV1JIGmLGw6w2Fl8GYxn3eKh0nPzxy02bVLW8pklSwKWpHCf7WCI9VD5kzTgO98zV98Q1G6YklPzcoVySb4FlxFI9gmu7cypRYe7wyLopRIE0mf9nP7vgiOEmM85eFdARcx7HNfbU1S+SbB4O3R6udsNpGTpQ2ZWh3BvIbJqeR5DprUeZBFfGcatBJuwzzcp/4IN9UoiYPXBSuHPbPw2sIry6cN4lumKOKddW481LbgkPMGg2V5yvmQwmOar1NaYBQaOpp2LctgkSI1KSxM8W8k3G9W2+UM1Vmi9jYvYbyGfHEt7NlBulEtDjN94VsP62FEUGEJjcX7FThVjk5OK2Lhk85H/JqtqcNRBKcVRrNRQz1ekdEZx1w== github-action" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H 45.32.184.212 >> ~/.ssh/known_hosts
      
      - name: Deploy via SSH
        run: ssh root@45.32.184.212

      
      
    
